<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title data-i18n="title">Höstlov 2025 – Närvaroanmälan</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>window.onload = () => emailjs.init("64vIY_pmg15yG6lYv");</script>
  <script src="email.js"></script>

  <style>
    body { font-family:"Source Sans Pro",sans-serif; background:#ffffff; margin:2rem; }
    #lang-select { position:fixed; top:1rem; right:1rem; padding:0.3rem; }
    header{display:flex;align-items:center;margin-bottom:1rem}
    header img{height:60px;margin-right:1rem}
    h1{color:#003366;font-size:1.75rem;margin:0}

    form{background:#fff;padding:1rem;border-radius:5px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:1rem}
    label{display:block;margin-bottom:0.75rem}
    input,input[type="time"],textarea{width:100%;padding:0.5rem;box-sizing:border-box}

    .info-box{background:#fff7e6;border-left:6px solid #ffa726;padding:1rem;margin-bottom:1rem;border-radius:5px;font-size:0.95rem;line-height:1.5;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
    .info-box p{margin:0.5rem 0}

    .controls{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem}
    .controls>*{flex:1;min-width:120px}

    .calendar-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:1rem;margin:1rem 0}
    .day-card{display:flex;flex-direction:column;background:#e3f2fd;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);padding:1rem 1rem 3rem;box-sizing:border-box;overflow-wrap:break-word}
    .day-card[data-closed]{background:#fdecea;color:#a94442;justify-content:center;text-align:center}
    .day-header{font-weight:600;margin-bottom:0.5rem;color:#003366;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .note{flex:1 1 auto;margin-bottom:0.5rem;font-size:0.9rem;white-space:normal;overflow-wrap:break-word}

    .toggles{display:flex;flex-direction:column;gap:0.5rem;margin-top:auto}
    .toggles button{width:100%;padding:0.5rem;border:2px solid #ccc;border-radius:4px;background:#fafafa;cursor:pointer;transition:background .2s,border-color .2s;white-space:nowrap;text-align:center}
    .toggles button.active{background:#4a90e2;color:#fff;border-color:#4a90e2}
    .toggles button:hover{background:#e1f0ff}
    .day-card[data-closed] .toggles,
    .day-card[data-closed] .time-inputs { display:none!important; }

    .time-inputs{display:none;flex-direction:column;gap:0.3rem;margin-top:0.5rem}
    .time-inputs input{border:1px solid #ccc;border-radius:4px}

    button[type="button"]{margin-right:0.5rem;background:#0072c6;color:#fff;border:none;border-radius:3px;padding:.4rem .8rem;cursor:pointer}
    button[type="button"]:hover{background:#005a9e}

    button[type="submit"]{background:#0055a5;color:#fff;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer}
    button[type="submit"]:hover{background:#004080}

    #status{font-weight:bold;margin-top:0.5rem}

    /* Popup */
    #overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);z-index:999}
    #summary-box{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:1.5rem;border:2px solid #0055a5;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.2);max-width:90%;white-space:pre-wrap;z-index:1000}
    #summary-box button#close-summary{position:absolute;top:.5rem;right:.5rem;background:transparent;border:none;font-size:1.2rem;cursor:pointer}
    #summary-box h2{margin-top:0;color:#0055a5}
  </style>
</head>
<body>

  <!-- Språkväljare -->
  <select id="lang-select">
    <option value="sv">Svenska</option>
    <option value="en">English</option>
    <option value="ar">العربية</option>
    <option value="so">Soomaali</option>
    <option value="ti">ትግርኛ</option>
    <option value="am">አማርኛ</option>
  </select>

  <header>
    <img src="stockholm-logo.svg" alt="Stockholms stad logotyp">
    <h1 data-i18n="heading">Höstlov 2025 – Närvaroanmälan</h1>
  </header>

  <div class="info-box" data-i18n="info"></div>

  <form id="form">
    <label data-i18n="labelParent">Vårdnadshavares namn:<input type="text" id="parentName" required></label>
    <label data-i18n="labelYouth">Ungdomens namn:<input type="text" id="youthName" required></label>
    <label data-i18n="labelEmail">Vårdnadshavares e-post:<input type="email" id="parentEmail" required></label>

    <label data-i18n="labelComments">Övriga kommentarer:<textarea id="kommentar" rows="4"></textarea></label>

    <div class="controls">
      <button type="button" id="selectAllYes" data-i18n="btnAllYes">Kommer alla dagar</button>
      <button type="button" id="selectAllNo" data-i18n="btnAllNo">Kommer ingen dag</button>
      <div><label data-i18n="labelFromAll">Från alla:<input type="time" id="globalFrom" value="09:00"></label></div>
      <div><label data-i18n="labelToAll">Till alla:<input type="time" id="globalTo" value="17:00"></label></div>
      <button type="button" id="applyTimes" data-i18n="btnApplyTimes">Tilldela tider</button>
    </div>

    <div class="calendar-grid" id="calendarGrid"></div>

    <button type="submit" data-i18n="btnSubmit">Skicka närvaro</button>
  </form>

  <p id="status"></p>

  <!-- Popup och overlay -->
  <div id="overlay"></div>
  <div id="summary-box">
    <button id="close-summary">×</button>
    <h2 data-i18n="popupTitle">Din sammanfattning</h2>
    <pre id="summary-content"></pre>
  </div>

  <script>
    // Översättningar (automatgenererat)
    const i18n = {
      sv: {
        title: "Höstlov 2025 – Närvaroanmälan",
        heading: "Höstlov 2025 – Närvaroanmälan",
        info: `<p><strong>Snart är höstlovet här</strong> och för vår planering av verksamheten behöver vi veta vilka ungdomar som kommer till Smultronet.</p>
               <p>Vi kommer att ha mycket <strong>uteaktiviteter</strong> under höstlovet och det är därför viktigt att ungdomen har med sig <strong>lämpliga kläder</strong> för detta.</p>
               <p><strong>Taxi under höstlov:</strong> Ta kontakt med skolan för att boka om färdtjänst.</p>
               <p><strong>EJ INLÄMNAD NÄRVAROANMÄLAN</strong> innebär att er ungdom inte kommer till oss.</p>
               <p><strong>Glöm inte färdtjänstkort eller busskort om du har!</strong></p>
               <p><strong>OBS!</strong> Smultronets öppettider under lovet är <strong>09.00–17.00</strong>.</p>
               <p style="margin-top:1rem">Med vänliga hälsningar,<br><em>personalen på Smultronet</em></p>`,
        labelParent: "Vårdnadshavares namn:",
        labelYouth: "Ungdomens namn:",
        labelEmail: "Vårdnadshavares e-post:",
        labelComments: "Övriga kommentarer:",
        btnAllYes: "Kommer alla dagar",
        btnAllNo: "Kommer ingen dag",
        labelFromAll: "Från alla:",
        labelToAll: "Till alla:",
        btnApplyTimes: "Tilldela tider",
        btnSubmit: "Skicka närvaro",
        popupTitle: "Din sammanfattning"
      },
      en: {
        title: "Autumn Break 2025 – Attendance",
        heading: "Autumn Break 2025 – Attendance",
        info: `<p><strong>The autumn break is coming soon</strong> and for our planning we need to know which youths will attend Smultronet.</p>
               <p>We will have many <strong>outdoor activities</strong> during the break, so it's important that youths bring appropriate clothing.</p>
               <p><strong>Taxi during the break:</strong> Contact the school to reschedule transport.</p>
               <p><strong>NO SUBMISSION</strong> means your youth will not attend.</p>
               <p><strong>Don't forget transport or bus cards!</strong></p>
               <p><strong>NOTE!</strong> Smultronet's opening hours are <strong>09:00–17:00</strong>.</p>
               <p style="margin-top:1rem">Kind regards,<br><em>the Smultronet team</em></p>`,
        labelParent: "Parent's name:",
        labelYouth: "Youth's name:",
        labelEmail: "Parent's email:",
        labelComments: "Other comments:",
        btnAllYes: "Attend all days",
        btnAllNo: "Attend no days",
        labelFromAll: "From all:",
        labelToAll: "To all:",
        btnApplyTimes: "Apply times",
        btnSubmit: "Submit attendance",
        popupTitle: "Your summary"
      },
      ar: {
        title: "عطلة الخريف 2025 – تسجيل الحضور",
        heading: "عطلة الخريف 2025 – تسجيل الحضور",
        info: `<p><strong>عطلة الخريف قادمة قريبًا</strong> ولتخطيطنا نحتاج لمعرفة من سيحضر Smultronet.</p>
               <p>سنقوم بالعديد من <strong>الأنشطة الخارجية</strong> خلال العطلة، لذا من المهم أن يحضر الشباب ملابس مناسبة.</p>
               <p><strong>التاكسي خلال العطلة:</strong> اتصل بالمدرسة لإعادة جدولة النقل.</p>
               <p><strong>عدم الإرسال</strong> يعني أن ابنك لن يحضر.</p>
               <p><strong>لا تنسَ بطاقات النقل أو الباص!</strong></p>
               <p style="margin-top:1rem">مع التحية،<br><em>فريق Smultronet</em></p>`,
        labelParent: "اسم الوالد/الوالدة:",
        labelYouth: "اسم الشاب/الشابة:",
        labelEmail: "بريد الوالد الإلكتروني:",
        labelComments: "ملاحظات أخرى:",
        btnAllYes: "يحضر كل الأيام",
        btnAllNo: "لا يحضر أي يوم",
        labelFromAll: "من الكل:",
        labelToAll: "إلى الكل:",
        btnApplyTimes: "تطبيق الأوقات",
        btnSubmit: "إرسال التسجيل",
        popupTitle: "ملخصك"
      },
      so: {
        title: "Nasashada Dayrta 2025 – Kaqeybgal",
        heading: "Nasashada Dayrta 2025 – Kaqeybgal",
        info: `<p><strong>Nasashada dayrta waa soo socotaa</strong> waxaana u baahanahay inaan ogaano cida ka qayb geli doonta Smultronet.</p>
               <p>Waxaan qaban doonaa <strong>hawlo bannaanka ah</strong> inta lagu jiro nasashada, sidaa darteed waa muhiim in dhallinyaradu soo qaataan dhar ku habboon.</p>
               <p><strong>Taksi inta lagu jiro nasashada:</strong> La xiriir iskuulka si aad u beddesho gaadiidka.</p>
               <p><strong>Haddii aan la dirin</strong> waxay ka dhigan tahay in dhallinyarku aanu imaan doonin.</p>
               <p><strong>Ha iloobin kaadhadhka safarka ama basaska!</strong></p>
               <p style="margin-top:1rem">Salaan,<br><em>Kooxda Smultronet</em></p>`,
        labelParent: "Magaca Waalidka:",
        labelYouth: "Magaca Dhallinyarada:",
        labelEmail: "Emailka Waalidka:",
        labelComments: "Faallooyin kale:",
        btnAllYes: "Ka qaybqaado dhammaan maalmaha",
        btnAllNo: "Maamul maalinna uma imaan",
        labelFromAll: "Laga bilaabo dhammaan:",
        labelToAll: "Ilaa dhammaan:",
        btnApplyTimes: "Codso waqtiyada",
        btnSubmit: "Dir kaqeybgalka",
        popupTitle: "Soo koobid"
      },
      ti: {
        title: "ዝግዝታ ክረምቲ 2025 – መካነ መተውዒ",
        heading: "ዝግዝታ ክረምቲ 2025 – መካነ መተውዒ",
        info: `<p><strong>ክረምቲ ምድሪ ቀርቦ ኣሎ</strong>ንዝግጅት ዝተዘጋጁ ደውሎ፣ ወጻኢታት መካነ Smultronet ክምትወድኦም ክወስዱ ይኽእል።</p>
               <p>ኣብ ክረምቲ ዝግዝታ ብዙሓት <strong>ምጥቃም ወጻኢታት</strong> ክሰርሑ ይኽእል እያ፣ ኣብ ዝኾነ ግዜ ወጻኢታት ልብስ ዝተስፋፋ ኣለዉ ኣለዉ ኢና።</p>
               <p><strong>ታክሲ ኣብ ክረምቲ:</strong> እቲ ትምህርቲ ማዕከል ንምውጋጋድ ኣጋጣሚ ትገብር።</p>
               <p><strong>ብዘይ ኣስተሓሳስባ</strong> ወጻኢ ክወጥበይ ኣይክእልዎ።</p>
               <p><strong>ካብ ጉብዝ ወይ ባስ ካርድ ኣብቲ እምበር!</strong></p>
               <p style="margin-top:1rem">ብሰላም፣<br><em>ቡድን Smultronet</em></p>`,
        labelParent: "ስም ወላጅ:",
        labelYouth: "ስም ወጻኢ:",
        labelEmail: "ኢሜይል ወላጅ:",
        labelComments: "ተቐባብሎታት:",
        btnAllYes: "ምምታታ ሓደኻብ ቀናት",
        btnAllNo: "ቀን ኣይክእልን",
        labelFromAll: "ካብ ሓደኻብ:",
        labelToAll: "ክሳብ ሓደኻብ:",
        btnApplyTimes: "ግዜታት ተወሳኺ",
        btnSubmit: "መተውዒ ላኽ",
        popupTitle: "መጠቓሚ ጠቓሚ"
      },
      am: {
        title: "የመጋቢት በዓል 2025 – መመዝገቢያ",
        heading: "የመጋቢት በዓል 2025 – መመዝገቢያ",
        info: `<p><strong>የመጋቢት በዓል በቅርብ ይመጣል</strong> ስለ እርስዎ ያስፈልጋል ለድርጅታችን ይዘው የሚመጡትን ያነቡ።</p>
               <p>ብዙ <strong>ውጪ እንቅስቃሴዎች</strong> እንደሚካሄዱ ስለዚህ የተሻለ ልብስ ያስይዙ።</p>
               <p><strong>ታክሲ በበዓል:</strong> ለትምህርት ቤት ትራንስፖርት ያስተካክሉ።</p>
               <p><strong>ካልተላከ</strong> ልጅዎ አይመጣውም።</p>
               <p><strong>ትራንስፖርት ወይም ባስ ካርድ አይርሱ!</strong></p>
               <p style="margin-top:1rem">በክብር፣<br><em>Smultronet ቡድን</em></p>`,
        labelParent: "የወላጅ ስም፡",
        labelYouth: "የወጣት ስም፡",
        labelEmail: "የወላጅ ኢሜይል፡",
        labelComments: "ሌሎች ማስተያየቶች፡",
        btnAllYes: "ሁሉም ቀናት ይመጣሉ",
        btnAllNo: "ማንም ቀን አይመጣ።",
        labelFromAll: "ከሁሉም ጀምሮ፡",
        labelToAll: "እስከ ሁሉም፡",
        btnApplyTimes: "ጊዜያት ማስተካከል",
        btnSubmit: "መመዝገቢያ ያስገቡ",
        popupTitle: "የእርስዎ ማጠቃለያ"
      }
    };

    function setLanguage(lang) {
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        el.innerHTML = i18n[lang][key] || i18n.sv[key];
      });
    }
    document.getElementById("lang-select")
      .addEventListener("change", e => setLanguage(e.target.value));
    setLanguage("sv");
  </script>

  <!-- Kalender, formulär, popup‐skript (oförändrat) -->
  <script>
    async function loadCalendar() { /* … som tidigare … */ }
    /* … resten av ditt script för loadCalendar, controls, form submit, popup … */
  </script>
</body>
</html>
