<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Smultronet – Föräldraenkät</title>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>window.onload = () => emailjs.init("64vIY_pmg15yG6lYv");</script>

<style>
:root{--blue-1:#005AA5;--blue-2:#0072C6;--blue-3:#0094DA;--gray-1:#F5F5F5;--gray-2:#E0E0E0;--orange:#FFA726;--text:#333}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Source Sans Pro",Arial,sans-serif;background:var(--gray-1);color:var(--text)}
header{background:var(--blue-1);color:#fff;padding:1rem;display:flex;align-items:center;gap:.75rem}
header img{height:40px}
.info-box,form{background:#fff;margin:1rem;padding:1rem;border-radius:4px}
form label{display:block;margin-top:.75rem}
form input,form select,form textarea{width:100%;padding:.6rem;margin-top:.25rem}
button{width:100%;background:var(--blue-2);color:#fff;padding:.75rem;border:none}
#status{text-align:center;margin:1rem;font-weight:600}
</style>
</head>

<body>
<header>
<img src="stockholm-logo.png">
<h1 id="pageTitle">Smultronet – Föräldraenkät</h1>
</header>

<div class="info-box">
<h2 id="welcomeTitle"></h2>
<p id="welcomeText"></p>
</div>

<form id="surveyForm">
<label id="labelParent"></label><input name="parent" required>
<label id="labelChild"></label><input name="child" required>
<label id="labelEmail"></label><input name="email" type="email" required>

<label>
<select id="lang">
<option value="sv">Svenska</option>
<option value="en">English</option>
<option value="ar">العربية</option>
<option value="so">Soomaali</option>
<option value="am">አማርኛ</option>
</select>
</label>

<label id="q1Label"></label><select name="q1" id="q1"></select>
<label id="q2Label"></label><select name="q2" id="q2"></select>
<label id="q3Label"></label><select name="q3" id="q3"></select>
<label id="q4Label"></label><select name="q4" id="q4"></select>
<label id="q5Label"></label><select name="q5" id="q5"></select>

<label id="q6Label"></label><textarea name="q6"></textarea>
<label id="q7Label"></label><textarea name="q7"></textarea>

<button type="submit" id="submitBtn"></button>
</form>

<p id="status"></p>

<script src="email.js"></script>

<script>
const texts={
sv:{
pageTitle:"Smultronet – Föräldraenkät",
welcomeTitle:"Hej!",
welcomeText:"Den här enkäten hjälper oss att förbättra Smultronet.",
labelParent:"Förälderns namn",
labelChild:"Barnets namn",
labelEmail:"Förälderns e-post",
q1:"Hur nöjd är du totalt?",
q2:"Känner du att ditt barn är tryggt?",
q3:"Hur upplever du personalens bemötande?",
q4:"Fungerar aktiviteterna bra?",
q5:"Får du tillräcklig information?",
q6:"Vad fungerar bra?",
q7:"Vad kan bli bättre?",
submit:"Skicka",
opts:{
q1:["Mycket nöjd","Nöjd","Varken eller","Missnöjd","Mycket missnöjd"],
q2:["Ja, alltid","Oftast","Ibland","Nej"],
q3:["Mycket bra","Bra","Okej","Mindre bra"],
q4:["Ja","Delvis","Nej"],
q5:["Ja","Delvis","Nej"]
}}
};

function setLang(l){
const t=texts[l]||texts.sv;
pageTitle.innerText=t.pageTitle;
welcomeTitle.innerText=t.welcomeTitle;
welcomeText.innerText=t.welcomeText;
labelParent.innerText=t.labelParent;
labelChild.innerText=t.labelChild;
labelEmail.innerText=t.labelEmail;
q1Label.innerText=t.q1;
q2Label.innerText=t.q2;
q3Label.innerText=t.q3;
q4Label.innerText=t.q4;
q5Label.innerText=t.q5;
q6Label.innerText=t.q6;
q7Label.innerText=t.q7;
submitBtn.innerText=t.submit;
["q1","q2","q3","q4","q5"].forEach(id=>{
const s=document.getElementById(id);s.innerHTML="";
t.opts[id].forEach(o=>{const op=document.createElement("option");op.text=o;s.add(op)});
});
}
lang.onchange=e=>setLang(e.target.value);
setLang("sv");

surveyForm.onsubmit=async e=>{
e.preventDefault();
const d=Object.fromEntries(new FormData(surveyForm));
await firebase.firestore().collection("enkater").add({...d,timestamp:firebase.firestore.Timestamp.now()});

const summary=`Förälder: ${d.parent}
Barn: ${d.child}
Nöjdhet: ${d.q1}
Trygghet: ${d.q2}
Personal: ${d.q3}
Aktiviteter: ${d.q4}
Information: ${d.q5}
Bra: ${d.q6}
Bättre: ${d.q7}`;

const ok=await skickaBekräftelse(d.parent,d.email,d.child,summary,d.q6+"\n"+d.q7);
status.innerText=ok?"✅ Tack! Ditt svar är inskickat.":"⚠️ E-post kunde inte skickas.";
surveyForm.reset();
setLang("sv");
};
</script>
</body>
</html>
